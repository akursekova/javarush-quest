# javarush-quest

## Краткое описание

Данный проект - это текстовый квест. Вопрос на каждом следующем шаге зависит от предыдущего ответа.

При запуске квеста пользователю открывается приветственная страница.
На этой странице игроку предлагается ввести своё имя, чтобы начать игру.

>Приветственная страница:
>
>![img.png](img.png)

После того как игрок ввел своё имя и нажал на кнопку [Introduce yourself], запускается квест.

>Первый вопрос квеста:
>
>![img_1.png](img_1.png)

В случае, если игрок не указал свое имя, но нажал на кнопку [Introduce yourself], квест сгенерирует исключение, которое
оповестит пользователя о том, что имя не может быть пустым.  
У пользователя также есть возможность вернуться назад по нажатию кнопки [Go back]. 

>Обработка ошибки:
>
>![img_7.png](img_7.png)

Задача игрока отвечать на вопросы квеста, выбирая один из представленных вариантов ответа и нажать на кнопку [Answer].

Если игрок не выбрал ни один из ответов, приложение сгенерирует алерт для юзера, подсказывающий ему сделать выбор.

>Алерт:
>
>![img_6.png](img_6.png)

В зависимоти от выбранного ответа, игра приводит к выигрышу или проигрышу.

При любом результате игрок может начать квест заново, а также посмотреть статистику по сыгранным играм.

>Окно статистики:
>
>![img_2.png](img_2.png)

# Запуск проекта из Docker:

- Установить [Docker](https://docs.docker.com/install)
- Перейти по ссылке https://github.com/akursekova/javarush-quest/tree/dev и нажать Donwnload ZIP
- Имя скачанного проекта будет javarush-quest-dev, так как проект скачан из dev ветки
- Открыть проект в IntelliJ IDEA 
- Открыть Terminal в IntelliJ IDEA  
- Запустить команду % mvn clean install: сгенерируется папка target, в котрой будет находиться javarush-quest.war  
- Убедиться что текущая директория - это javarush-quest-dev 
- $docker build -t javarush-quest-dev .
- $docker run -p 7777:8080 javarush-quest-dev
- http://localhost:7777/javarush-quest/quest

>Приложение запущенное на http://localhost:7777/javarush-quest/quest:
>
>![img_4.png](img_4.png)

# Краткое описание классов

Данный квест - это Maven-проект, в котором соблюдена стандартная для Maven-проекта структура:
- в папке src/main/java содержатся java-классы
- в src/main/resources — ресурсы, которые использует данное приложение
- src/test — пакет для хранения тестов. 

`pom.xml` лежит в корне проекта и содержит все необходимые для корректного функционирования проекта Maven зависимости.

В корневом пакете проекта `dev.akursekova.quest` хранятся классы:
- `AppServletContextListener`
- `ExceptionHandlerServlet`
- `QuestServlet`,  

а также пакеты:
- `repository`
- `service`
- `subjects`

В пакете `subjects` содержатся классы, описывающие основные объекты данного квеста:
- `User`: описывает общие поля и методы, принадлежащие игроку, принимающему участие в игре.
- `Question`, `Answer`: отвечает за поля и методы вопросов/ответов, появляющихся в игре.

В пакете `repository` хранится класс `UserRepository`, ответственный за хранение всех пользователей в системе.

В пакете `service` хранится `QuestionService` - класс, в котором хранится всё дерево вопросов квеста.  
В методе `init()` данного класса инициализируется все дерево вопросов, а в самом сервисе хранится только ссылка на первый вопрос.

Класс `AppServletContextListener` - это listener, который во время запуска приложения создает все экземпляры сервисов и 
помещает их в сервлет контекст.

Класс `QuestServlet` - основной класс данного квеста. В методах `doGet` и `doPost` реализована основная бизнес-логика:
- логика отображения вопросов/ответов
- перемещение между jsp страницами
- проверка выбрал ли игрок какой-либо ответ

Класс `ExceptionHandlerServlet` - это класс, ответственный за обработку ошибок. 

В пакете `webapp`, находщемуся по пути src/main/webapp хранятся 3 директории:
- `WEB-INF` - пакет, где хранятся все jsp страницы проекта:
  - `index.jsp` - jsp, ответственная за приветственную страницу
  - `question.jsp` - jsp, в которой описана логика отображения вопросов, ответов, а также кнопки [Answer], [Restart], [Statistics]
  - `exception.jsp` - jsp, на которую происходит перенаправление из ExceptionHandlerServlet в момент, когда в квесте 
  произошла какая-либо ошибка
- `css` - пакет, где хранятся стили, используемые jsp страницами
- `img` - пакет, где хранится изображение, используемое для фона квеста  

и `web.xml`, который хранит информацию о конфигурации приложения. В данном случае web.xml хранит value сервлета 
ExceptionHandlerServlet, отвечающего за генерацию исключений.

# Логирование
К данному проекту подключен логер Log4j.  

Логер сконфигурирован в xml формате.  
Конфигурация хранится по пути `src/main/resources/log4j2.xml`.  

Логи записываются в файл, расположенный по пути `"/Users/alinakursekova/Downloads/javarush-quest/logs/quest.log"`.  

_Если данное приложение будет запускаться на другом компьютере, для корректной работы логера нужно указать путь к файлу на локальном компьютере._

# Тестирование
Логика данного квеста покрыта тестами. Тесты написаны с использованием JUnit5 и Mockito.

В классе `dev.akursekova.quest.QuestServletTest` находятся тесты, покрывающие основную бизнесс логику квеста.
Тесты проверяют различные сценарии, как негативные, так и позитивные для методов doGet и doPost.  

Примеры сценариев, покрытых тестами: 
- проверка поведения, если новый пользователь начал игру
- проверка поведения, когда пользователь не выбрал ни один из ответов, но нажал кнопку [Answer]
- проверка поведения, когда пользователь нажимает на кнопку [Restart] 

В классе `dev.akursekova.quest.repository.UserRepositoryTest` находятся тесты, покрывающие функионал, 
ответственный за добавление нового пользователя в репозиторий.  

Примеры сценариев, покрытых тестами: 
- проверка поведения, когда новый пользователь не ввел свое имя и оставил поле пустым
- проверка на существование пользователя в системе
- проверка на добавление нового пользователя в репозиторий




